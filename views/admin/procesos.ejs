<!DOCTYPE html>
<html lang="es">
<head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Admin — Procesos</title><link rel="stylesheet" href="/css/style.css"/></head>
<body>
  <%- include('../partials/navbar') %>
  <main class="container card">
    <%- include('../partials/admin_nav') %>
    <h1>Ventas — Registrar venta</h1>
    <%- include('../partials/flash', { msg }) %>
    <form method="post" action="/admin/procesos" class="row">
      <div class="col"><label>Producto</label>
        <select name="producto_id" class="input">
          <% productos.forEach(p => { %>
            <option value="<%= p.id %>"><%= p.codigo %> — <%= p.nombre %> (<%= p.stock %> en stock)</option>
          <% }) %>
        </select>
      </div>
      <div class="col"><label>Cantidad</label><input class="input" name="cantidad" type="number" value="1" min="1"/></div>
      <div class="col"><button class="btn" style="margin-top:24px">Registrar venta</button></div>
    </form>

    <h2>Comprobantes recientes</h2>
    <table>
      <thead><tr><th>Fecha</th><th>Producto</th><th class="right">Cantidad</th><th class="right">Total</th><th>Folio</th></tr></thead>
      <tbody>
        <% ventas.forEach(v => { %>
          <tr>
            <td><%= new Date(v.fecha).toLocaleString('es-CL') %></td>
            <td><%= v.producto_nombre %></td>
            <td class="right"><%= v.cantidad %></td>
            <td class="right">$<%= v.total.toLocaleString('es-CL') %></td>
            <td><span class="pill"><%= v.folio %></span></td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </main>
  <%- include('../partials/footer') %>
  <script src="/js/main.js"></script>
</body>
</html>
